(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{507:function(e,t,i){"use strict";i.r(t);var o=i(794),s=i(647);for(var n in s)"default"!==n&&function(e){i.d(t,e,function(){return s[e]})}(n);i(763);var r=i(3),a=Object(r.a)(s.default,o.a,o.b,!1,null,null,null);t.default=a.exports},523:function(e,t,i){"use strict";t.__esModule=!0,t.default=function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}},647:function(e,t,i){"use strict";i.r(t);var o=i(648),s=i.n(o);for(var n in o)"default"!==n&&function(e){i.d(t,e,function(){return o[e]})}(n);t.default=s.a},648:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=C(i(64)),o=C(i(131)),l=C(i(132)),s=C(i(279)),n=C(i(528)),c=C(i(669)),u=C(i(520)),r=C(i(42)),d=C(i(134)),v=b(i(34)),f=b(i(573)),h=i(35),w=C(i(278)),_=C(i(676)),k=C(i(276)),R=C(i(626)),p=C(i(135));function b(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function C(e){return e&&e.__esModule?e:{default:e}}var g=i(7),L="bookReviewListStoreModule",m="bookStoreModule",I=i(22),B=i(67);t.default={name:"BookReviewList",components:{Avatar:s.default,RankBar:n.default,Loading:d.default,BookCover:k.default,ReviewStarControl:R.default},asyncData:function(e){var t=e.store,i=e.user,o=e.route,s=e.envConfig;t.registerModule(L,(0,c.default)()),t.registerModule(m,(0,u.default)());var n=o.query.bookId;B.v(n)||console.log("[zhoonlog] asyncData wrong bookId");var r=B.d(n);return l.default.all([t.dispatch(v.FETCH_BOOK_REVIEW_LIST,{bookId:r,listType:f.ReviewListTypeBookTop,envConfig:s}),t.dispatch(v.FETCH_BOOK_REVIEW_LIST,{bookId:r,listType:f.ReviewListTypeBookFriendTop,envConfig:s}),t.dispatch(v.FETCH_BOOK_REVIEW_BOOK_INFO,{bookId:r,hasLogin:g.hasLogin(i),envConfig:s})])},data:function(){return{hasExpandedReviewIds:[],isSendingReview:!1}},created:function(){g.isEnvClient&&(this.$store.registerModule(L,(0,c.default)(),{preserveState:!0}),(0,w.default)(),(0,_.default)())},destroyed:function(){this.$store.unregisterModule(m),this.$store.unregisterModule(L)},mounted:function(){var i=this;this.updateContentHasMoreClass(),r.default.handleElementScrollEvent(window,function(){i.handleLoadMoreReviews()},function(e){var t=e.scrollTop;i.$refs.bottomBar.style.display=220<t?"block":"none"}),this.haveReportInfo("Reader_Click_Rating_Button")&&(this.reportClientBusiness({itemName:"Web_Reader_Rating_Clk"},"Reader_Click_Rating_Button"),this.reportClientBusiness({itemName:"Web_BookReviewList_Enter_ReaderRating"})),this.haveReportInfo("Reader_TopReview_MoreReviews_Clk")&&(this.reportClientBusiness({itemName:"Web_Reader_TopReview_More_Clk"},"Reader_TopReview_MoreReviews_Clk"),this.reportClientBusiness({itemName:"Web_BookReviewList_Enter_ReaderTopReview"})),this.reportClientBusiness({itemName:"Web_BookReviewList_Enter"})},computed:(0,o.default)({bookId:function(){var e=this.$router.currentRoute.query;return e&&e.bookId&&B.v(e.bookId)?B.d(e.bookId):""},showRating:function(){return 0<this.ratingCount&&0<this.starScore},ratingCount:function(){return this.bookInfo.ratingCount||0},starScore:function(){return this.bookInfo.star||0},starString:function(){return(this.starScore/10).toFixed(1)},displayTotalReviewList:function(){return this.displayFriendReviewList.concat(this.reviewList)},displayFriendReviewList:function(){return 20<this.friendReviewList.length?this.friendReviewList.slice(0,20):this.friendReviewList}},(0,h.mapState)({bookInfo:function(e){return e[L].bookInfo},reviewList:function(e){return e[L].topReviews.reviewList},isFetching:function(e){return e[L].topReviews.isFetching},hasMore:function(e){return e[L].topReviews.hasMore},synckey:function(e){return e[L].topReviews.synckey},friendReviewList:function(e){return e[L].topFriendReviews.reviewList}})),watch:{reviewList:function(){this.updateContentHasMoreClass()}},methods:{handleContentClick:function(e){var t=document.querySelectorAll(".bookReviewList_item .content");if(e-=this.displayFriendReviewList.length,t&&0<t.length&&0<=e&&e<=t.length-1){var i=t[e],o=i.innerHTML;if(i&&i.classList.contains("hasMore")){i.classList.remove("content_Normal"),i.innerHTML=o.replace(/\n/gi,"<br />");var s=i.outerHTML;i.outerHTML=s}}},updateContentHasMoreClass:function(){this.$nextTick(function(){for(var e=document.querySelectorAll(".bookReviewList_item .content"),t=0;t<e.length;t++){var i=e[t];if(i)if(i.scrollHeight>i.offsetHeight)i.classList.add("hasMore");else{i.classList.remove("hasMore"),i.classList.remove("content_Normal");var o=i.innerHTML;i.innerHTML=o.replace(/\n/gi,"<br />")}}})},filterReviewContent:function(e){return I.get(e,"review.content","")},handleBookReviewClick:function(e){var r=this,t=e.score;this.hasLogin?(this.reportClientBusiness({itemName:"Web_BookReviewList_WriteBookReview"}),this.$showWriteReviewDialog({vid:this.user.vid||0,bookId:this.bookId,score:t},function(){r.$toast("发表中...",36e4)},function(e){var t=e.bookId,i=e.content,o=e.star,s=e.isPrivate,n=e.friendship;r.$writeReviewDialog.getIsSending()||(r.$writeReviewDialog.setIsSending(!0),r.$writeReviewDialog.setIsSendedSucc(!0),r.$store.dispatch(v.FETCH_BOOK_REVIEW_ADD,{bookId:t,content:i,star:o,isPrivate:s,friendship:n}).then(function(e){console.log("[zhoonlog] res = "+(0,a.default)(e.data));var t=I.get(e,"data.reviewId","");t&&0<t.length?(r.$hideToast(),r.$toast("发表成功"),r.$writeReviewDialog.closeDialog(),r.reportClientBusiness({itemName:"Web_WriteBookReview_Succ"}),setTimeout(function(){window.location.reload()},2e3)):(r.$hideToast(),r.$toast("发表失败，请重试")),r.$writeReviewDialog.setIsSending(!1)}).catch(function(e){r.$hideToast(),r.$toast("发表失败，请重试"),r.$writeReviewDialog.setIsSending(!1),console.log("[zhoonlog] err = "+e)}))})):this.$showLoginDialog({bottomTitle:"扫码登录微信读书",bottomSubTitle:"登录后可以点评此书"})},handleReadThisBook:function(){var e=this.readerURL(this.bookId,{autoscroll:1});e&&(0,p.default)(e)},handleLoadMoreReviews:function(){if(!this.isFetching&&this.hasMore){var e=this.bookId,t=this.synckey,i=this.reviewList.length;e&&this.$store.dispatch(v.FETCH_BOOK_REVIEW_LIST,{bookId:e,listType:f.ReviewListTypeBookTop,maxIdx:i,append:!0,synckey:t})}}}}},649:function(e,t,i){},763:function(e,t,i){"use strict";var o=i(649);i.n(o).a},794:function(e,t,i){"use strict";function o(){var i=this,e=i.$createElement,o=i._self._c||e;return o("div",{staticClass:"bookReviewList_container"},[o("div",{staticClass:"bookReviewList_header"},[o("div",{staticClass:"bookReviewList_bookScore"},[i.showRating?o("p",{staticClass:"score"},[i._v(i._s(i.starString))]):i._e(),o("ReviewStarControl",{staticClass:"starControl",attrs:{title:"为此书评分","title-align":"right","init-score":0},on:{"emit-review-star-click":i.handleBookReviewClick}})],1),o("div",{staticClass:"bookReviewList_bookInfo"},[o("BookCover",{attrs:{"custom-selector":"bookReviewList_cover",src:i.bookInfo.cover,needGradientDecor:!0},on:{click:i.handleReadThisBook}}),o("div",{staticClass:"bookReviewList_infoDetail"},[o("p",{staticClass:"title"},[i._v(i._s(i.bookInfo.title))]),o("p",{staticClass:"author"},[i._v(i._s(i.bookInfo.author))]),o("p",{staticClass:"read"},[o("a",{staticClass:"wr_btn wr_btn_Big read_button",attrs:{href:"javascript:"},on:{click:i.handleReadThisBook}},[i._v("开始阅读")])])])],1)]),i.reviewList.length<=0?o("div",{staticClass:"bookReviewList_empry"},[o("p",[i._v("此书暂无精彩点评")])]):i._e(),0<i.displayTotalReviewList.length?o("div",{staticClass:"bookReviewList_content"},[o("p",{staticClass:"bookReviewList_title"},[i._v("精彩点评")]),o("ul",{staticClass:"bookReviewList_list"},i._l(i.displayTotalReviewList,function(e,t){return o("li",{key:t,staticClass:"bookReviewList_item"},[o("div",{staticClass:"title"},[o("Avatar",{attrs:{clickable:!1,src:e.review.author.avatar,"custom-selector":"avatar"}}),o("span",{staticClass:"name"},[i._v(i._s(e.review.author.name))]),o("span",{staticClass:"action"},[i._v("点评")]),0<e.review.star?o("RankBar",{staticClass:"star",attrs:{star:e.review.star,"custom-selector":"wr_rankBar_Small"}}):i._e()],1),e.review.content&&0<e.review.content.length?o("p",{ref:"content",refInFor:!0,staticClass:"content content_Normal",domProps:{innerHTML:i._s(i.filterReviewContent(e))},on:{click:function(e){return i.handleContentClick(t)}}}):i._e()])}),0)]):i._e(),o("div",{ref:"bottomBar",staticClass:"bookReviewList_bottomBar"},[o("div",{staticClass:"bookReviewList_bottomBar_Inner"},[o("a",{staticClass:"wr_btn wr_btn_Big read_button",attrs:{href:"javascript:"},on:{click:i.handleReadThisBook}},[i._v("开始阅读")]),o("a",{staticClass:"review_button",attrs:{href:"javascript:"},on:{click:i.handleBookReviewClick}},[i._v("点评此书")]),o("div",{staticClass:"bottomBar_bookInfo"},[o("BookCover",{attrs:{"custom-selector":"cover",src:i.bookInfo.cover,needGradientDecor:!0}}),o("div",{staticClass:"infoDetail"},[o("p",{staticClass:"title"},[i._v(i._s(i.bookInfo.title))]),o("p",{staticClass:"author"},[i._v(i._s(i.bookInfo.author))])])],1)])]),o("div",{directives:[{name:"show",rawName:"v-show",value:i.isFetching,expression:"isFetching"}],staticClass:"bookReviewList_loading"},[o("Loading",{attrs:{zoom:"0.4"}})],1)])}var s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})}}]);