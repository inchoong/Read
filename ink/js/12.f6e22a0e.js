(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{506:function(e,t,o){"use strict";o.r(t);var n=o(795),a=o(644);for(var r in a)"default"!==r&&function(e){o.d(t,e,function(){return a[e]})}(r);o(762);var i=o(3),u=Object(i.a)(a.default,n.a,n.b,!1,null,null,null);t.default=u.exports},644:function(e,t,o){"use strict";o.r(t);var n=o(645),a=o.n(n);for(var r in n)"default"!==r&&function(e){o.d(t,e,function(){return n[e]})}(r);t.default=a.a},645:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=T(o(131)),u=T(o(132)),a=T(o(276)),s=T(o(761)),r=T(o(520)),i=T(o(668)),l=T(o(42)),_=T(o(134)),h=E(o(34)),d=E(o(60)),f=o(35),c=T(o(278));function E(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}function T(e){return e&&e.__esModule?e:{default:e}}var A=o(7),S="searchBooksStoreModule";t.default={name:"SearchBookList.vue",components:{Loading:_.default,BookCover:a.default,BookListItem:i.default},asyncData:function(e){var n=e.store,t=e.route,o=e.envConfig;n.registerModule(S,(0,s.default)());var a=t.query,r=void 0;a.author?r=n.dispatch(h.FETCH_SEARCH_BOOK_DETAIL_RESULT,{envConfig:o,type:0,keyword:a.author}):a.publisher?r=n.dispatch(h.FETCH_SEARCH_BOOK_DETAIL_RESULT,{envConfig:o,type:1,keyword:a.publisher}):a.keyword&&(r=n.dispatch(h.FETCH_SEARCH_BOOK_DETAIL_RESULT,{envConfig:o,type:2,keyword:a.keyword}));var i=a.author||a.publisher||a.keyword;return new u.default(function(t,o){r.then(function(e){n.commit(d.UPDATE_PAGE_TITLE,i+"-全部作品在线阅读-微信读书"),n.commit(d.UPDATE_PAGE_KEYWORDS,[i,i+" 最新连载",i+" 好看的书",i+" 新书",i+" 推荐",i+" 粉丝"].join(",")),n.commit(d.UPDATE_PAGE_DESCRIPTION,i+"全部作品："+n.getters.getDescriptionBookName),t(e)}).catch(function(e){o(e)})})},created:function(){A.isEnvClient&&(this.$store.registerModule(S,(0,s.default)(),{preserveState:!0}),this.$store.registerModule("bookStoreModule",(0,r.default)(),{preserveState:!0}),(0,c.default)())},destroyed:function(){this.$store.unregisterModule(S)},data:function(){return{}},mounted:function(){var t=this,e=this;A.isEnvClient&&(l.default.handleElementScrollEvent(window,function(){e.handleLoadMoreBooks()}),this.haveReportInfo("SearchResult_Click_Author")&&this.reportClientBusiness({itemName:"Web_Search_ResultClk"}),this.haveReportInfo("SearchResult_Click_Publisher")&&this.reportClientBusiness({itemName:"Web_Search_ResultClk"}),this.$nextTick(function(){var e=t.$refs.headerDetail;e&&(e.scrollHeight>e.offsetHeight?e.classList.add("hasMore"):e.classList.remove("hasMore"))}))},methods:{handleLoadMoreBooks:function(){if(!this.isFetching&&this.hasMore)return this.$store.dispatch(h.FETCH_SEARCH_BOOK_DETAIL_RESULT,{type:this.listType,keyword:this.$route.query.author||this.$route.query.publisher||this.$route.query.keyword,maxIdx:this.maxIndex,append:!0})},handleAddShelfEvent:function(e){var t=this;this.hasLogin?this.$store.dispatch(h.FETCH_SEARCH_BOOK_DETAIL_ADD_SHELF,{bookId:e}).then(function(e){e&&t.$toast("加入书架成功")}):this.$showLoginDialog({bottomTitle:"扫码登录微信读书",bottomSubTitle:"在书架随时阅读本书"})},handleDetailClick:function(){var e=this.$refs.headerDetail;e.classList.add("search_bookDetail_header_detail_Active"),e.classList.remove("search_bookDetail_header_detail_Normal")}},computed:(0,n.default)({listType:function(){var e=this.$route.query;return e.author?0:e.publisher?1:e.keyword?2:-1},maxIndex:function(){return this.bookInfos&&0<this.bookInfos.length?this.bookInfos[this.bookInfos.length-1].searchIdx:0},bookInShelfObj:function(){if(this.bookInShelfData){for(var e={},t=0;t<this.bookInShelfData.length;t++){var o=this.bookInShelfData[t];e[o.bookId]=1===o.onShelf}return e}return{}},headerDefaultTitleText:function(){return this.$route.query.author||this.$route.query.publisher||this.$route.query.keyword||""}},(0,f.mapState)({bookInfos:function(e){return e[S].bookInfos},isFetching:function(e){return e[S].isFetching},hasMore:function(e){return e[S].hasMore},totalCount:function(e){return e[S].totalCount},readingCount:function(e){return e[S].readingCount},headerTitle:function(e){return e[S].headerTitle},headerDetail:function(e){return e[S].headerDetail},bookInShelfData:function(e){return e[S].bookInShelfData}}))}},646:function(e,t,o){},761:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(o(131)),r=c(o(132)),a=c(o(133)),i=c(o(277));t.default=function(){var e,t;return{state:{headerTitle:"",headerDetail:"",bookInfos:[],hasMore:!1,isFetching:!1,totalCount:0,bookInShelfData:[]},getters:{getDescriptionBookName:function(e){for(var t=Math.min(10,e.bookInfos.length),o=[],n=0;n<t;n++)o.push(e.bookInfos[n].bookInfo.title);return o.join("，")}},mutations:(e={},(0,a.default)(e,l.UPDATE_SEARCH_BOOK_DETAIL_RESULT,function(e,t){var o,n=t.bookInfos.filter(function(e){return _.default.isSupportedBookType(e.type)});t.append?(o=e.bookInfos).push.apply(o,(0,i.default)(n)):e.bookInfos=n}),(0,a.default)(e,l.UPDATE_SEARCH_BOOK_DETAIL_HAS_MORE,function(e,t){e.hasMore=t.hasMore}),(0,a.default)(e,l.UPDATE_SEARCH_BOOK_DETAIL_TOTAL_COUNT,function(e,t){e.totalCount=t.totalCount}),(0,a.default)(e,l.UPDATE_SEARCH_BOOK_DETAIL_FETCH_STATE,function(e,t){e.isFetching=t.isFetching}),(0,a.default)(e,l.UPDATE_SEARCH_BOOK_DETAIL_HEADER,function(e,t){e.headerTitle=t.headerTitle,e.headerDetail=t.headerDetail}),(0,a.default)(e,l.UPDATE_SEARCH_BOOK_DETAIL_IN_SHELF,function(e,t){var o=t.bookInShelfData;if(t.edit){for(var n=0;n<e.bookInShelfData.length;n++)if(o.bookId===e.bookInShelfData[n].bookId){var a=e.bookInShelfData[n];a.onShelf=o.onShelf,e.bookInShelfData[n]=a;break}}else{for(var r=[],i=[],u=0;u<o.length;u++){var s=o[u];-1===i.indexOf(s.bookId)&&(r.push(s),i.push(s.bookId))}e.bookInShelfData=r}}),e),actions:(t={},(0,a.default)(t,u.FETCH_SEARCH_BOOK_DETAIL_RESULT,function(e,t){var o=e.commit,n=e.dispatch;o(l.UPDATE_SEARCH_BOOK_DETAIL_FETCH_STATE,{isFetching:!0});var a=[];return 0===t.type?a.push(n(u.FETCH_SEARCH_AUTHOR_BOOKS_RESULT,t)):1===t.type?a.push(n(u.FETCH_SEARCH_PUBLISHER_BOOKS_RESULT,t)):2===t.type&&a.push(n(u.FETCH_SEARCH_BOOK_NAME_BOOKS_RESULT,t)),r.default.all(a).then(function(t){return o(l.UPDATE_SEARCH_BOOK_DETAIL_FETCH_STATE,{isFetching:!1}),new r.default(function(e){e(t)})}).catch(function(e){o(l.UPDATE_SEARCH_BOOK_DETAIL_FETCH_STATE,{isFetching:!1}),console.log("err","-",e)})}),(0,a.default)(t,u.FETCH_SEARCH_AUTHOR_BOOKS_RESULT,function(e,t){var i=e.commit,u=t.append||!1;return(0,s.default)("/web/search/author_books",(0,n.default)({author:t.keyword||"",maxIdx:t.maxIdx||0,count:t.count||40},t.envConfig),function(e){var t=E.get(e,"data.books",[]),o=1===E.get(e,"data.hasMore","0"),n=E.get(e,"data.authorinfos",[]),a=0<n.length?n[0]:{};i(l.UPDATE_SEARCH_BOOK_DETAIL_HEADER,{headerTitle:a.author||"",headerDetail:a.authorinfo||""});var r=E.get(e,"data.totalCount",0);i(l.UPDATE_SEARCH_BOOK_DETAIL_RESULT,{bookInfos:t,append:u}),i(l.UPDATE_SEARCH_BOOK_DETAIL_HAS_MORE,{hasMore:o}),i(l.UPDATE_SEARCH_BOOK_DETAIL_TOTAL_COUNT,{totalCount:r})},function(e){console.log("err","-",e)})}),(0,a.default)(t,u.FETCH_SEARCH_PUBLISHER_BOOKS_RESULT,function(e,t){var a=e.commit,r=t.append||!1;return(0,s.default)("/web/search/publisher_books",(0,n.default)({keyword:t.keyword||"",maxIdx:t.maxIdx||0,count:t.count||40},t.envConfig),function(e){var t=E.get(e,"data.books",[]),o=1===E.get(e,"data.hasMore","0"),n=E.get(e,"data.totalCount",0);a(l.UPDATE_SEARCH_BOOK_DETAIL_RESULT,{bookInfos:t,append:r}),a(l.UPDATE_SEARCH_BOOK_DETAIL_HAS_MORE,{hasMore:o}),a(l.UPDATE_SEARCH_BOOK_DETAIL_TOTAL_COUNT,{totalCount:n})},function(e){console.log("err","-",e)})}),(0,a.default)(t,u.FETCH_SEARCH_BOOK_NAME_BOOKS_RESULT,function(e,t){var a=e.commit,r=t.append||!1;return(0,s.default)("/web/search/name_books",(0,n.default)({keyword:t.keyword||"",maxIdx:t.maxIdx||0,count:t.count||40},t.envConfig),function(e){var t=E.get(e,"data.books",[]),o=1===E.get(e,"data.hasMore","0"),n=E.get(e,"data.totalCount",0);a(l.UPDATE_SEARCH_BOOK_DETAIL_HEADER,{headerTitle:"出现在书名中的结果",headerDetail:"共 "+n+" 条"}),a(l.UPDATE_SEARCH_BOOK_DETAIL_RESULT,{bookInfos:t,append:r}),a(l.UPDATE_SEARCH_BOOK_DETAIL_HAS_MORE,{hasMore:o}),a(l.UPDATE_SEARCH_BOOK_DETAIL_TOTAL_COUNT,{totalCount:n})},function(e){console.log("err","-",e)})}),(0,a.default)(t,u.FETCH_SEARCH_BOOK_DETAIL_IN_SHELF,function(e){var t=e.commit,o=e.dispatch,n=e.state.bookInfos.map(function(e){return e.bookInfo.bookId}).join(",");n.length&&o(u.FETCH_IN_SHELF,{bookIds:n}).then(function(e){t(l.UPDATE_SEARCH_BOOK_DETAIL_IN_SHELF,{bookInShelfData:e,edit:!1})}).catch(function(e){console.log("err","-",e)})}),(0,a.default)(t,u.FETCH_SEARCH_BOOK_DETAIL_ADD_SHELF,function(e,t){var o=e.commit;return(0,e.dispatch)(u.FETCH_ADD_SHELF,{bookIds:[t.bookId]}).then(function(e){if(!0===e||0<e.length)return o(l.UPDATE_SEARCH_BOOK_DETAIL_IN_SHELF,{bookInShelfData:{bookId:t.bookId,onShelf:1},edit:!0}),!0;console.log("data","-",e)}).catch(function(e){console.log("err","-",e)})}),t)}};var s=c(o(192)),u=f(o(34)),l=f(o(60)),_=c(o(191)),h=c(o(35)),d=c(o(26));function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}function c(e){return e&&e.__esModule?e:{default:e}}var E=o(22);d.default.use(h.default)},762:function(e,t,o){"use strict";var n=o(646);o.n(n).a},795:function(e,t,o){"use strict";function n(){var o=this,e=o.$createElement,n=o._self._c||e;return n("div",{staticClass:"search_bookDetail_wrap"},[n("div",{staticClass:"search_bookDetail_header"},[n("div",{class:{search_bookDetail_header_Book:2===o.listType,search_bookDetail_header_Author:0===o.listType,search_bookDetail_header_Publisher:1===o.listType}},[n("p",{staticClass:"search_bookDetail_header_title"},[o._v(o._s(o.headerTitle||o.headerDefaultTitleText))]),0<o.headerDetail.length?n("p",{ref:"headerDetail",staticClass:"search_bookDetail_header_detail search_bookDetail_header_detail_Normal",on:{click:o.handleDetailClick}},[o._v(o._s(o.headerDetail))]):o._e()])]),n("ul",{staticClass:"search_bookDetail_list"},o._l(o.bookInfos,function(e,t){return n("BookListItem",{key:e?e.bookInfo.bookId:t,attrs:{"show-add-shelf-button":!0,"book-in-shelf-obj":o.bookInShelfObj,"book-index":t,"book-data":e},on:{handleBookListItemAddShelfEvent:o.handleAddShelfEvent}})}),1),n("div",{directives:[{name:"show",rawName:"v-show",value:o.isFetching,expression:"isFetching"}],staticClass:"search_bookDetail_loading"},[n("Loading",{attrs:{zoom:"0.4"}})],1)])}var a=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return a})}}]);